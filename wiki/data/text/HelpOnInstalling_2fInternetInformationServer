'''Index'''
[[TableOfContents]]

== Requirements ==

Before you install MoinMoin:MoinMoin, make sure you have the necessary infra-structure in place, namely the ''Internet Information Services'' webserver (any version should be OK), and a ''Python'' installation (version 2.0 or higher is recommended, don't run 1.5.2 without a compelling reason).

In the following description, we assume that you have installed or will install things to these locations:
 * IIS to its default location
 * `C:\Python` - the Python interpreter
 * `C:\Moin` - Moin``Moin itself

Quite often, you might want to install things elsewhere, which is no problem at all; you just have to adapt any paths that appear in a command or config file to the locations you have chosen.

This installation procedure was tested with IIS 5 for Windows running on Windows 2000sp2, and using Python 2.2.

== Preparation ==

=== Installing IIS ===

You currently need an external webserver to run Moin``Moin. 

From Microsoft: (http://www.microsoft.com/windows2000/en/server/iis/)

  To install IIS, add components, or remove components:

  Click Start, point to Settings, click Control Panel and start the Add/Remove Programs application. 
  Select Configure Windows, click the Components button, and then follow the on-screen instructions 
  to install, remove, or add components to IIS. 

Make sure that your webserver runs without problems before you start to install Moin``Moin; problems with your webserver installation are not in the scope of this document.

=== Installing Python ===

Download [http://www.python.org/ftp/python/2.1.2/Python-2.1.2.exe Python 2.1.2] and install it. Python installation is done via a standard Windows installer program.

=== Installing MoinMoin ===

Before creating a wiki instance, you have to download and install the basic Moin``Moin software. We assume you already have downloaded the distribution archive to the "`C:\TEMP`" directory[[FootNote(If you want to install the current development version from CVS, replace "C:\TEMP" with your "moin" working directory.)]].

Open a console window and enter the following commands:
{{{
C:
cd \temp
unzip moin-0.11.zip
cd moin-0.11
python setup.py install --prefix=C:\Moin --record=install.log
}}}

This will install all necessary files to the "`C:\Moin`" directory, and create a "`install.log`" file listing all the files that are created there.

[[FootNote]]

== Creating a Wiki Instance ==

You could run your wiki directly using the sample wiki created in "`C:\Moin`", but this is not recommended for two reasons:
 1. updating your wiki is more complicated and more dangerous.
 1. creating a second wiki instance, even if you currently don't plan for one, is much easier.

So, enter these commands in a console window:
{{{
cd \Moin
md mywiki
md mywiki\data
xcopy share\moin\data mywiki\data /E
copy share\moin\cgi-bin mywiki
copy share\moin\htdocs\index.html mywiki\default.htm
}}}

"`mywiki`" is the name of your wiki instance, you might want to chose a different name best fitting the intended use of this instance; just don't name it simply "`wiki`", because that would result in problems later on.

We have to make sure that `moin.cgi` can find the Moin``Moin directory, so that "{{{import MoinMoin}}}" will work. You can either setup a `PYTHONPATH` environment variable which includes the installation path, but sometimes it can be tricky to make sure the variable will be set in the CGI environment. The easiest way to make sure `MoinMoin` can be imported is to append to `sys.path` ''within'' `moin.cgi`.

You can change the first two lines of code in moin.cgi to something like this:
{{{
#!python
import sys
sys.path.append(r'C:\Moin')
}}}
Notice that we're pointing to the directory which contains the Moin``Moin directory, not the directory itself.

 /!\ '''Python 2.2''': Python 2.2 changed the installation layout. Because of this, you have to change the line of code given above to "{{{sys.path.append(r'C:\Moin\Lib\site-packages')}}}". 

Next, you'll need to create two virtual directories in IIS. One for the shared data, and one for this specific wiki instance. 

Go to ''Control Panel => Administrative Tools => Internet Information Service''. Open up the tree to ''Default Web Site''. 

Right click on ''Default Web Site'' and choose ''New => Virtual directory''. This will bring up a wizard with the manditory useless first screen, hit next. Enter "`wiki`" for the alias name and hit next. Browse to "`C:\Moin\share\moin\htdocs`" and hit next. Leave the ''Access permissions'' at their defaults and hit next. And now you're done, hit finish!

Now follow the same steps, but set the alias to "`mywiki`" and the path to "`C:\Moin\mywiki`". 

Now you need to setup the 'mywiki' alias so that it will run Python to interpret `.cgi` files. Right click on your new 'mywiki' alias and choose ''Properties''. On the first tab (''Virtual Directory''), click the ''Configuration'' button. The first tab is the ''App Mappings'' tab, which defines which programs to use for each file exetension. Click ''Add''. Browse to your `python.exe` (probably something like `c:\pythonXX\python.exe`). Then add {{{-u %s %s}}} after the Python executable path. The ''Executable'' line will look something like this: {{{C:\Python22\python.exe -u %s %s}}}. In the ''Extension'' box enter {{{.cgi}}} with the begining period. Confirm that the ''Check that file exists'' option is not checked (if it is, Moin``Moin won't be able to display sub pages). Ok, you're done with the alias configuration, click ''OK'' several times to get back out of all the dialog boxes.

If you add another wiki instance, you'll only need to setup the reference to its folder, they can safely share the "`wiki`" alias which points to static files only.

That is all, try to access your new-born wiki with the URL "`http://127.0.0.1/mywiki/`". You should see the Front``Page, try to edit and save it, and if that works, see if your edit is reflected on the Recent``Changes page.

Finally, edit "`moin_config.py`" and at least change "`sitename`" and "`logo_url`" to some personal values:
{{{
sitename = 'My Wiki'
logo_url = '/images/mywiki-logo.gif'
}}}

For a personal or intranet installation, you'll normally also add the line {{{
allowed_actions = ['DeletePage', 'AttachFile']
}}}

=== Troubleshooting ===

If you see an error like "{{{ImportError: No module named MoinMoin}}}", it means that python cannot find Moin``Moin. See above for how to set your `PYTHONPATH` or add to `sys.path`.


